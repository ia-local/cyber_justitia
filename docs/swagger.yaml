swagger: '2.0'
info:
  title: Cyber-Justitia API
  version: 1.1.0 # Mise à jour de la version
  description: API Backend pour l'investigation numérique (OSINT, Juridique, Traçage, Académie).
host: localhost:3110
basePath: /
schemes:
  - http

tags:
  - name: Chat IA & Juridique
    description: Endpoints pour l'assistance par IA (Groq) et la qualification pénale, incluant l'assistance Académique.
  - name: OSINT & Traces
    description: Outils de simulation d'enquête numérique (WHOIS, GeoIP) et traçage cartographique des flux d'attaques.

paths:
  /api/chat:
    post:
      tags:
        - Chat IA & Juridique
      summary: Assistant IA (via Groq)
      description: Permet d'interroger un des rôles experts. Le rôle 'legal' est désormais optimisé pour répondre en se basant sur la base de connaissances interne (Académie).
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              message:
                type: string
                description: Message de l'utilisateur.
              roleId:
                type: string
                enum: [manager, awareness, grc, prevention, trust, legal]
                description: Rôle IA sélectionné pour la réponse (ex: 'legal' pour l'analyse pénale).
      responses:
        '200':
          description: Réponse de l'IA.
          schema:
            type: object
            properties:
              reply:
                type: string
              roleName:
                type: string
  
  /api/osint/scan:
    post:
      tags:
        - OSINT & Traces
      summary: Lancer un Scan OSINT simulé
      description: Exécute un outil de simulation (WHOIS, IP Geo, Email Breach) sur une cible technique.
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              tool:
                type: string
                enum: [whois, ip_geo, email_breach]
              target:
                type: string
                description: IP, domaine ou email à analyser.
      responses:
        '200':
          description: Résultat de la simulation OSINT.

  /api/mapping/trace:
    post:
      tags:
        - OSINT & Traces
      summary: Tracer un Flux Géographique (Rebonds d'Attaque)
      description: Simule le traçage des rebonds d'une cible (IP, domaine) pour visualiser le chemin d'attaque sur la carte.
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              target:
                type: string
                description: Domaine ou IP à tracer (ex: 'ecom-phish.com' pour un scénario).
      responses:
        '200':
          description: Chemin de traçage simulé (liste d'objets avec lat, lng, info).
          schema:
            type: object
            properties:
              summary:
                type: string
              trace_path:
                type: array
                items:
                  $ref: '#/definitions/TracePoint'

definitions:
  TracePoint:
    type: object
    properties:
      lat:
        type: number
        format: float
        description: Latitude du point de rebond.
      lng:
        type: number
        format: float
        description: Longitude du point de rebond.
      info:
        type: string
        description: Description du nœud (hébergeur, proxy, etc.).
      type:
        type: string
        enum: [Origin, Rebound, Destination]
        description: Rôle du nœud dans la chaîne d'attaque.